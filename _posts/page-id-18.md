---
title: 美多商城项目实战EP02：后端配置，用户部分-用户模型类
date: 2024-01-26 11:18:50
img: https://wangxs020202.gitee.io/pbad/background/mdmall.png
top: false
summary: 美多商城项目实战EP02：后端配置，用户部分-用户模型类
categories: 美多商城
tags:
  - 美多商城
  - Python
  - Django
  - DRF
---

### 一、写在前面

这篇文章主要是对美多商城项目的后端进行配置，数据库配置，log日志配置，用户部分的用户模型类的编写。

### 二、后端配置

#### 2.1 文件目录

```bash
.
|____db.sqlite3
|____users
| |____migrations
| | |______init__.py
| | |______pycache__
| | | |______init__.cpython-310.pyc
| |____models.py
| |______init__.py
| |______pycache__
| | |____models.cpython-310.pyc
| | |____admin.cpython-310.pyc
| | |____apps.cpython-310.pyc
| | |______init__.cpython-310.pyc
| |____apps.py
| |____admin.py
| |____tests.py
| |____views.py
|____MDmall_Backend
| |____asgi.py
| |______init__.py
| |______pycache__
| | |____urls.cpython-310.pyc
| | |____wsgi.cpython-310.pyc
| | |______init__.cpython-310.pyc
| |____settings.py
| |____urls.py
| |____wsgi.py
|____manage.py
|____.idea
| |____MDmall_Backend.iml
| |____inspectionProfiles
| | |____profiles_settings.xml
| | |____Project_Default.xml
| |____.gitignore
| |____workspace.xml
| |____modules.xml
| |____misc.xml
```

#### 2.2 配置文件

这是我对配置文件做了一些修改，分开了开发环境和生产环境的配置，这样可以方便的进行切换。

##### 2.2.1 创建Settings文件夹

```bash
mkdir Settings
```

将`settings.py`文件移动到`Settings`文件夹下，并重命名为`base.py`。

##### 2.2.2 创建`develop.py`和`produce.py`文件

```bash
touch develop.py
touch produce.py
```

##### 2.2.3 修改`base.py`文件

将`ALLOWED_HOSTS`和`DATABASES`的配置放到`develop.py`和`produce.py`文件中。

在`INSTALLED_APPS`中添加如下内容：

```python
INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    "users",
    "rest_framework",
    "corsheaders",
    "channels"
]
```

由于后面我们会用到log日志，所以在`base.py`文件中添加如下内容：

```python
if not os.path.exists(os.path.join(BASE_DIR, 'logs')):
    os.mkdir(os.path.join(BASE_DIR, 'logs'))
```

##### 2.2.4 修改`manage.py`文件

```python
#!/usr/bin/env python
"""Django's command-line utility for administrative tasks."""
import os
import sys
from Settings import base


def main():
    """Run administrative tasks."""
    if base.DEBUG:
        os.environ.setdefault("DJANGO_SETTINGS_MODULE", "Settings.develop")
    else:
        os.environ.setdefault("DJANGO_SETTINGS_MODULE", "Settings.produce")
    try:
        from django.core.management import execute_from_command_line
    except ImportError as exc:
        raise ImportError(
            "Couldn't import Django. Are you sure it's installed and "
            "available on your PYTHONPATH environment variable? Did you "
            "forget to activate a virtual environment?"
        ) from exc
    execute_from_command_line(sys.argv)


if __name__ == "__main__":
    main()
```

#### 2.3 依赖包下载

##### 2.3.1 创建`requirements.txt`文件夹

写入以下内容：

```bash
django-rest-framework==0.1.0
django==4.1.7
django-cors-headers==3.14.0
pymysql==1.0.2
pandas==1.5.3
pexpect==4.8.0
pyjwt==2.6.0
channels==4.0.0
channels-redis==4.1.0
uvicorn[standard]
scapy==2.5.0
cabfile==1.0.0
django-rest-swagger==2.2.0
gunicorn==21.2.0
cryptography==41.0.3
```

这些依赖包是我在开发过程中用到的，如果你在开发过程中用到了其他的依赖包，可以在这里添加。

##### 2.3.2 下载依赖包

```bash
pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple
```

#### 2.4 数据库配置

在`Settings`文件夹下的`develop.py`和`produce.py`文件中配置数据库。

文件内容如下：

`develop.py`

```python
"""
Django develop settings for project.

Generated by 'django-admin startproject' using Django 4.1.7.
"""

from Settings.base import *


# 允许访问的ip
ALLOWED_HOSTS = ["*"]

# Database
# https://docs.djangoproject.com/en/4.1/ref/settings/#databases
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.mysql',
        'NAME': "md_mall",
        'USER': "root",
        'PASSWORD': "123456",
        'PORT': 3306,
        'HOST': "localhost",
    }
}
```

`produce.py`

```python
"""
Django develop settings for project.

Generated by 'django-admin startproject' using Django 4.1.7.
"""

from Settings.base import *


# 允许访问的ip
ALLOWED_HOSTS = ["*"]

# Database
# https://docs.djangoproject.com/en/4.1/ref/settings/#databases
DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.mysql',
        'NAME': "md_mall",
        'USER': "root",
        'PASSWORD': "123456",
        'PORT': 3306,
        'HOST': "localhost",
    }
}
```

这里的数据库配置是我本地的数据库配置，如果你的数据库配置不同，可以在这里进行修改。

在与`Settings`文件夹同级的目录的`users`文件夹下的`__init__.py`文件中添加如下内容：

```python
import pymysql
pymysql.install_as_MySQLdb()
```

#### 2.5 日志配置

日志如何配置，可以参考我的另一篇文章：[在Python世界中游刃有余：如何灵活运用Django日志记录功能](https://sirxs.cn/2023/04/24/logging/)


### 三、用户部分-用户模型类

#### 3.1 用户模型类

在`users`文件夹下的`models.py`文件中添加如下内容：

```python
from django.db import models
from django.contrib.auth.models import AbstractUser

# Create your models here.

class User(AbstractUser):
    """用户模型类"""
    mobile = models.CharField(max_length=11, unique=True, verbose_name='手机号')

    class Meta:
        db_table = 'md_users'
        verbose_name = '用户'
        verbose_name_plural = verbose_name
```

在`base.py`文件中添加如下内容：

```python
AUTH_USER_MODEL = "users.User"
```

#### 3.2 编写序列化器

在`users`文件夹下创建`serializer.py`文件，编写如下内容：

```python
from rest_framework import serializers
from users.models import User

class UserSerializer(serializers.ModelSerializer):
    class Meta:
        # 指定序列化的模型
        model = User
        # 指定序列化的字段
        fields = ['id', 'username', 'mobile', 'email', 'is_staff', 'is_active', 'date_joined', 'last_login']
        depth = 1
```


#### 3.3 数据库迁移

```bash
python manage.py makemigrations
python manage.py migrate
```








